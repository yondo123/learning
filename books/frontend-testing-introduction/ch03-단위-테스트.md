# 3. ì²˜ìŒ ì‹œì‘í•˜ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

## ê°œë°œ í™˜ê²½ êµ¬ì„±

### JavaScript

```bash
# jest ì„¤ì •
npm install jest
```

### With TypeScript

```bash
#Babel í™˜ê²½ êµ¬ì„±
npm install -D @babel/core @babel/preset-env @babel/preset-typescript babel-jest

npm install @types/jest
npm install ts-jest
```

**jest.config.ts**

```typescript
import type { Config } from "jest";

const config: Config = {
  preset: "ts-jest", // TypeScript í™˜ê²½ì„ ìœ„í•œ preset
  testEnvironment: "node", // Node.js í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  moduleFileExtensions: ["ts", "js"], // ëª¨ë“ˆ íŒŒì¼ í™•ì¥ì
  testMatch: ["**/tests/**/*.test.ts"], // í…ŒìŠ¤íŠ¸ íŒŒì¼ ë§¤ì¹­ íŒ¨í„´
  transform: {
    "^.+\\.ts$": "ts-jest", // .ts íŒŒì¼ì„ ts-jestë¡œ ë³€í™˜
  },
  moduleNameMapper: {
    "^@src/(.*)$": "<rootDir>/src/$1", // @src ê²½ë¡œ ë§¤í•‘ ì¶”ê°€
  },
  moduleDirectories: ["node_modules", "src"], // ëª¨ë“ˆ í•´ì„ ê²½ë¡œ
  collectCoverage: true, // ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ìˆ˜ì§‘ ì—¬ë¶€
  coverageDirectory: "coverage", // ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ìƒì„± ìœ„ì¹˜
  coverageReporters: ["json", "lcov", "text", "clover"], // ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ í˜•ì‹
  setupFilesAfterEnv: ["./jest.config.ts"], // í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì • íŒŒì¼
  verbose: true, // ìƒì„¸í•œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¶œë ¥
};

export default config;
```

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ê¸°

```
//ğŸ“ package.json
{
	...
  "scripts": {
    "test:jest": "jest"
  },
}

```

## í…ŒìŠ¤íŠ¸ ì‘ì„±í•˜ê¸°

`test` í•¨ìˆ˜ë¡œ ì •ì˜í•  ìˆ˜ ìˆë‹¤. ì‚¬ìš© ë²•ì€ ì•„ë˜ì™€ ê°™ë‹¤.

```typescript
//í…ŒìŠ¤íŠ¸ ì´ë¦„ì—ëŠ” í•´ë‹¹ í•¨ìˆ˜ê°€ ì–´ë–¤ ë™ì‘ì„ í•˜ëŠ”ì§€ ì œëª©ë§Œ ë³´ì•„ë„ ì˜ ì•Œ ìˆ˜ ìˆë„ë¡ ì‘ì„±..
test("í…ŒìŠ¤íŠ¸ ì´ë¦„", func);
```

ë‹¨ì–¸ë¬¸ì€ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ì—ì„œ `expect` í•¨ìˆ˜ë¥¼ í†µí•´ ë‹¨ì–¸í•  ìˆ˜ ìˆë‹¤. ì—¬ëŸ¬ matcherë¥¼ í†µí•´ ê²°ê³¼ ë§¤ì¹­ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

```typescript
expect(ê²€ì¦ê°’).toBe(ê¸°ëŒ“ê°’);
toBe(ê¸°ëŒ“ê°’);
```

```typescript
import { add } from "@src/add";

test("add ê²€ì¦ í…ŒìŠ¤íŠ¸, 1+2=3", () => {
  expect(add).toBe(3);
});
```

### ê·¸ë£¹í™”

ì„œë¡œ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ìœ ë‹›(í•¨ìˆ˜)ë“¤ì„ `describe` í•¨ìˆ˜ë¥¼ í†µí•´ ê·¸ë£¹í™”ë¥¼ í•  ìˆ˜ ìˆë‹¤.  
`test` apiì™€ ë‹¤ë¥´ê²Œ `describe`ëŠ” ì¤‘ì²©ì´ ê°€ëŠ¥í•˜ë‹¤.

```typescript
describe("ì‚¬ì¹™ì—°ì‚° í…ŒìŠ¤íŠ¸", () => {
  describe("ë”í•˜ê¸°(add)", () => {
    test("1+1=2", () => {
      expect(add(1, 1)).toBe(2);
    });
    test("0+1=1", () => {
      expect(add(0, 1)).toBe(1);
    });
  });
  describe("ë¹¼ê¸°(sub)", () => {
    test("1-2=-1", () => {
      expect(sub(1, 2)).toBe(-1);
    });
    test("10-2=8", () => {
      expect(sub(10, 2)).toBe(8);
    });
  });
});
```

### ì‹¤íŒ¨ ì¼€ì´ìŠ¤

ë§Œì¼ í…ŒìŠ¤íŠ¸ ê²€ì¦ ê°’ì´ ê¸°ëŒ“ ê°’ê³¼ ë‹¤ë¥´ë‹¤ë©´ ì•„ë˜ ë¡œê·¸ì™€ ê°™ì´ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ê²Œ ëœë‹¤.

```bash
  â— ì‚¬ì¹™ì—°ì‚° í…ŒìŠ¤íŠ¸ â€º ë”í•˜ê¸°(add) â€º 1+1=2

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 2

      14 |   describe("ë”í•˜ê¸°(add)", () => {
      15 |     test("1+1=2", () => {
    > 16 |       expect(add(1, 1)).toBe(3);
         |                         ^
      17 |     });
      18 |     test("0+1=1", () => {
      19 |       expect(add(0, 1)).toBe(1);

      at Object.<anonymous> (tests/jest/simple.test.ts:16:25)

```

í…ŒìŠ¤íŠ¸ ì½”ë“œì— ë¬¸ì œê°€ ëª…í™•í•˜ê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

### ì˜ˆì™¸ ì¼€ì´ìŠ¤

**ì˜¤ë¥˜ ë©”ì‹œì§€ ê²€ì¦**
ë§Œì¼ ìœ ë‹› ì½”ë“œì—ì„œ ì˜ˆì™¸ê°€ ì¡´ì¬í•œë‹¤ë©´, í•´ë‹¹ ë‚´ìš©ì„ ì§ì ‘ í…ŒìŠ¤íŠ¸ í•˜ê¸° ì‰½ì§€ ì•Šë‹¤.
Jestì—ì„œëŠ” `toThrow` apië¥¼ í†µí•´ ì˜ˆì™¸ì— ëŒ€í•œ ê²€ì¦ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê³ , ì¸ìˆ˜ë¥¼ í†µí•´ í•´ë‹¹ ì˜ˆì™¸ì˜ ìƒì„¸í•œ ë‚´ìš©ì„ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.

```typescript
test("0 í˜¹ì€ 100 ì´ìƒì˜ ìˆ«ìê°€ ë“¤ì–´ì˜¤ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.", () => {
  //ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
  expect(() => addMinZeroMaxHundred(0, -1)).toThrow();
  expect(() => addMinZeroMaxHundred(0, -1)).toThrow(
    "a ë˜ëŠ” bëŠ” 0~100 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤."
  );
});
```

**í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ê²€ì¦**
Jestì˜ `toThrow` ì¸ìˆ˜ì—ì„œëŠ” ë©”ì‹œì§€ë¿ë§Œ ì•„ë‹ˆë¼ í´ë˜ìŠ¤ë„ í• ë‹¹ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•œ ì˜ˆì™¸ê°€ íŠ¹ì • í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì¸ì§€ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.

```typescript
test("0 í˜¹ì€ 100 ì´ìƒì˜ ìˆ«ìê°€ ë“¤ì–´ì˜¤ë©´ RangeErrorê°€ ë°œìƒí•œë‹¤.", () => {
  //RangeError ì—ëŸ¬ ê°ì²´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ (ì„±ê³µ)
  expect(() => addMinZeroMaxHundredRangeError(0, -1)).toThrow(RangeError);
  //Error ê°ì²´ê°€ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ (ìƒì† ë°›ì•˜ê¸° ë•Œë¬¸ì— ì„±ê³µ)
  expect(() => addMinZeroMaxHundredRangeError(0, -1)).toThrow(RangeError);
  //HTTPError ì—ëŸ¬ ê°ì²´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ (ì‹¤íŒ¨)
  expect(() => addMinZeroMaxHundredRangeError(0, -1)).toThrow(HttpError);
});
```

## Matcher

### toBeTruthy/toBeFalsy

ì§„ë¦¿ê°’ì„ íŒë³„í•˜ëŠ” matcher

```typescript
test("ì°¸ ê°’ í…ŒìŠ¤íŠ¸", () => {
  expect(1).toBeTruthy();
  expect("1").toBeTruthy();
  expect(true).toBeTruthy();
  //ë°˜ì „ì€ .not í‚¤ì›Œë“œ ì‚¬ìš©
  expect(0).not.toBeTruthy();
  expect(null).not.toBeTruthy();
  expect(undefined).not.toBeTruthy();
  expect("").not.toBeTruthy();
});

test("ê±°ì§“ ê°’ í…ŒìŠ¤íŠ¸", () => {
  expect(0).toBeFalsy();
  expect(null).toBeFalsy();
  expect(undefined).toBeFalsy();
  expect("").toBeFalsy();
});
```

### ìˆ˜ì¹˜ ê²€ì¦

```typescript
describe("ìˆ«ì í…ŒìŠ¤íŠ¸", () => {
  const TEST_VALUE = 3;
  test("ê²€ì¦ê°’ì´ ê¸°ëŒ“ê°’ê³¼ ì¼ì¹˜í•œë‹¤.", () => {
    expect(TEST_VALUE).toBe(3);
    expect(TEST_VALUE).toEqual(3);
  });

  test("ê²€ì¦ê°’ì´ ê¸°ëŒ“ê°’ë³´ë‹¤ í¬ë‹¤.", () => {
    expect(TEST_VALUE).toBeGreaterThan(2); //3 > 2
    expect(TEST_VALUE).toBeGreaterThanOrEqual(3); //3 >= 3
  });

  test("ê²€ì¦ê°’ì´ ê¸°ëŒ“ê°’ë³´ë‹¤ ì‘ë‹¤.", () => {
    expect(TEST_VALUE).toBeLessThan(4); //3 < 4
    expect(TEST_VALUE).toBeLessThanOrEqual(3); //3 <= 3
  });
});
```

**ì†Œìˆ˜ì  ê³„ì‚°**ì—ì„œëŠ” ì •í™•í•˜ì§€ ì•Šì€ JavaScript ì†Œìˆ˜ì  ê³„ì‚° ë³´ì™„ì„ ìœ„í•´ `toBeCloseTo` ë¥¼ í™œìš©í•´ ìë¦¿ìˆ˜ ê³„ì‚°ì„ í•  ìˆ˜ ìˆë‹¤.

```typescript
test("ì†Œìˆ˜ ê³„ì‚°ì€ ì •í™•í•˜ì§€ ì•Šë‹¤.", () => {
  expect(0.1 + 0.2).not.toBe(0.3);
  expect(0.1 + 0.2).toBeCloseTo(0.3);
});

test("ì†Œìˆ˜ ê³„ì‚°ì€ ì§€ì •í•œ ìë¦¿ìˆ˜ê¹Œì§€ë§Œ ë¹„êµí•œë‹¤.", () => {
  expect(0.1 + 0.2).toBeCloseTo(0.3, 1);
  expect(0.1 + 0.2).toBeCloseTo(0.3, 2);
});
```

### ë¬¸ìì—´ ê²€ì¦

- **toContain:** ë“±ê°€ ë¹„êµ í˜¹ì€ ë¬¸ìì—´ì˜ ì¼ë¶€ê°€ í¬í•¨ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.
- **toMatch:** ì§€ì •í•œ ì •ê·œí‘œí˜„ì‹ì„ ê²€ì¦í•œë‹¤.
- **toHaveLength**: ë¬¸ìì—´ ê¸¸ì´ë¥¼ ê²€ì¦í•œë‹¤.

```typescript
const GAME_NAME = "Super Mario Party";

//toContain
test("ê²Œì„ëª…ì€ 'Super Mario Party'ì´ë‹¤.", () => {
  expect(GAME_NAME).toBe("Super Mario Party");
  expect(GAME_NAME).toContain("Mario");
});

//toHaveLength
test("ê²Œì„ëª…ì€ ê³µë°± ì œì™¸ 15ìì´ë‹¤.", () => {
  expect(GAME_NAME.replace(/\s/g, "").length).toBe(15);
});

//toMatch
test("ê²Œì„ëª…ì— ë¬´ì¡°ê±´ 'Mario'ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.", () => {
  const firstGame = MARIO_GAMES[0];
  const secondGame = MARIO_GAMES[1];
  const thirdGame = MARIO_GAMES[2];

  expect(firstGame).toMatch(/Mario/);
  expect(secondGame).toMatch(/Mario/);
  expect(thirdGame).toMatch(/Mario/);
});
```

### ë°°ì—´ ê²€ì¦

ë°°ì—´ì˜ ì›ì‹œí˜•(primitive type)ì¸ íŠ¹ì •ê°’ì´ í¬í•¨ëëŠ”ì§€ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´ `toContain` ì„ ì‚¬ìš©í•œë‹¤.

```typescript
const MARIO_GAMES = ["Super Mario Bros", "Super Mario World", "Super Mario 64"];

test("toConatin í…ŒìŠ¤íŠ¸", () => {
  expect(MARIO_GAMES).toContain("Super Mario Bros");
});
```

ë°°ì—´ì— íŠ¹ì • ê°ì²´ê°€ í¬í•¨ëëŠ”ì§€ í™•ì¸í•  ë•ŒëŠ” `toContainEqual` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤.

```typescript
const SUPER_MARIO_WORLD = {
  name: "Super Mario World",
  year: 1990,
  platform: "SNES",
};

const SUPER_MARIO_BROS = {
  name: "Super Mario Bros",
  year: 1985,
  platform: "NES",
};

const MARIO_GAMES = [SUPER_MARIO_WORLD, SUPER_MARIO_BROS];

test("toContainEqual í…ŒìŠ¤íŠ¸", () => {
  expect(MARIO_GAMES).toContainEqual(SUPER_MARIO_WORLD);
});
```

### ê°ì²´ ê²€ì¦

ê°ì²´ ê²€ì¦ì€ `toMatchObject`ë¥¼ ì‚¬ìš©í•œë‹¤. ë¶€ë¶„ì ìœ¼ë¡œ í”„ë¡œí”¼í‹°ê°€ ì¼ì¹˜í•˜ë©´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼í•œë‹¤.  
íŠ¹ì • í”„ë¡œí„°í”¼ê°€ ìˆëŠ”ì§€ ê²€ì¦í•˜ë ¤ë©´ `toHaveProperty`ë¥¼ ì‚¬ìš©í•œë‹¤.

```typescript
const SUPER_MARIO_64 = {
  name: "Super Mario 64",
  year: 1996,
  platform: "N64",
};

test("toHaveProperty í…ŒìŠ¤íŠ¸", () => {
  expect(SUPER_MARIO_64).toHaveProperty("name");
  expect(SUPER_MARIO_64).toHaveProperty("year");
  expect(SUPER_MARIO_64).toHaveProperty("platform");
});

test("toMatchObject í…ŒìŠ¤íŠ¸", () => {
  expect(SUPER_MARIO_64).toMatchObject({
    name: "Super Mario 64",
  });
});
```

## ë¹„ë™ê¸° ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

```typescript
//ê°„ë‹¨í•œ ë¹„ë™ê¸° í•¨ìˆ˜
export const sampleTimer = (duration: number) => {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve(duration);
    }, duration);
  });
};
```

### Promiseë¥¼ ë°˜í™˜í•˜ëŠ” ë°©ë²•

ë‹¨ìˆœí•˜ê²Œ Promiseë¥¼ ë°˜í™˜í•´ ì „ë‹¬í•  resolveì— ë‹¨ì–¸ë¬¼ì„ ë„˜ê²¨ì£¼ëŠ” ë°©ì‹ì´ë‹¤.

```typescript
import { sampleTimer } from "@src/sampleTimer";

test("3ì´ˆê°€ íë¥¸ í›„ ê²½ê³¼ ì‹œê°„ê³¼ í•¨ê»˜ resolve ëœë‹¤.", () => {
  return sampleTimer(3000).then((result) => {
    expect(result).toBe(3000);
  });
});

test("3ì´ˆê°€ íë¥¸ í›„ ê²½ê³¼ ì‹œê°„ê³¼ í•¨ê»˜ resolve ëœë‹¤.", () => {
  return expect(sampleTimer(3000)).resolves.toBe(3000);
});
```

### async/awaitë¥¼ í™œìš©í•œ ë°©ë²•

í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë¥¼ `async` í•¨ìˆ˜ë¡œ ë§Œë“¤ê³ , í•¨ìˆ˜ ë‚´ì—ì„œ Promiseê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ë°©ë²•ì´ë‹¤.
`resolve` matcherë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¨ì–¸ë¬¸ë„ `await` ìœ¼ë¡œ ëŒ€ê¸°ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```typescript
test("3ì´ˆê°€ íë¥¸ í›„ ê²½ê³¼ ì‹œê°„ê³¼ í•¨ê»˜ resolve ëœë‹¤.", async () => {
  await expect(sampleTimer(3000)).resolves.toBe(3000);
});
```

ê²€ì¦ í•¨ìˆ˜ ìì²´ë¥¼ ëŒ€ê¸°ì‹œì¼œ ì™„ë£Œëœ í›„ ë‹¨ì–¸ë¬¸ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ë„ ê°€ëŠ¥í•˜ë‹¤.

```typescript
test("3ì´ˆê°€ íë¥¸ í›„ ê²½ê³¼ ì‹œê°„ê³¼ í•¨ê»˜ resolve ëœë‹¤.", async () => {
  expect(await sampleTimer(3000)).toBe(3000);
});
```

## Reject ê²€ì¦ í…ŒìŠ¤íŠ¸

ë¹„ë™ê¸° í•¨ìˆ˜ì—ì„œ `reject`ë˜ëŠ” ê²½ìš°ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ëŠ” ì¼€ì´ìŠ¤ì´ë‹¤.

```typescript
export const rejectSampleTimer = (duration: number) => {
  return new Promise((_, reject) => {
    setTimeout(() => {
      //ì‹¤íŒ¨ ì¼€ì´ìŠ¤ (duration ì „ë‹¬)
      reject(duration);
    }, duration);
  });
};
```

### catch ë©”ì„œë“œ ì „ë‹¬

```typescript
test("1ì´ˆ íë¥¸ í›„ rejectëœë‹¤.", () => {
  return rejectSampleTimer(1000).catch((duration) => {
    expect(duration).toBe(1000);
  });
});
```

### rejects matcher ì‚¬ìš©

```typescript
test("1ì´ˆ íë¥¸ í›„ reject ëœë‹¤.", () => {
  return expect(rejectSampleTimer(1000)).rejects.toBe(1000);
});

//await ì‚¬ìš©
test("1ì´ˆ íë¥¸ í›„ reject ëœë‹¤.", async () => {
  await expect(rejectSampleTimer(1000)).rejects.toBe(1000);
});
```

## í…ŒìŠ¤íŠ¸ ë‹¨ì–¸ë¬¸ í˜¸ì¶œ í™•ì¸

í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì‹œ ë‹¨ì–¸ë¬¸ì´ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ `expect.assertions` ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
ê¸°ëŒ€í•œ íšŸìˆ˜ë§Œí¼ ë‹¨ì–¸ë¬¸ì´ í˜¸ì¶œëëŠ”ì§€ ê²€ì¦í•œë‹¤.

```typescript
test("1ì´ˆ íë¥¸ í›„ reject ëœë‹¤.", async () => {
  expect.assertions(1);
  await expect(rejectSampleTimer(1000)).rejects.toBe(1000);
});
```
